# Há»‡ thá»‘ng PhÃ¢n quyá»n Urban Admin

## Giá»›i thiá»‡u

Urban Admin sá»­ dá»¥ng há»‡ thá»‘ng phÃ¢n quyá»n dá»±a trÃªn 3 vai trÃ² (Role-Based Access Control - RBAC):

1. **GiÃ¡m sÃ¡t (Supervisor)** - ğŸ‘¨â€ğŸ’¼
2. **Äiá»u phá»‘i (Coordinator)** - ğŸ“‹  
3. **NgÆ°á»i Ä‘i xá»­ lÃ½ (Handler)** - ğŸ”§

Má»—i vai trÃ² cÃ³ nhá»¯ng quyá»n háº¡n khÃ¡c nhau trong há»‡ thá»‘ng.

---

## Chi tiáº¿t vai trÃ² vÃ  quyá»n háº¡n

### 1. GiÃ¡m sÃ¡t (Supervisor) - Full Quyá»n ğŸŸ¢

**MÃ´ táº£:** Quáº£n lÃ½ viÃªn há»‡ thá»‘ng, cÃ³ toÃ n quyá»n truy cáº­p vÃ  quáº£n lÃ½

**Quyá»n háº¡n:**
- âœ… Xem danh sÃ¡ch sá»± cá»‘
- âœ… Táº¡o sá»± cá»‘ má»›i
- âœ… Chá»‰nh sá»­a thÃ´ng tin sá»± cá»‘
- âœ… XÃ³a sá»± cá»‘
- âœ… Cáº­p nháº­t tráº¡ng thÃ¡i xá»­ lÃ½
- âœ… GÃ¡n/Há»§y gÃ¡n ngÆ°á»i xá»­ lÃ½
- âœ… ThÃªm ghi chÃº/nháº­n xÃ©t
- âœ… Xem bÃ¡o cÃ¡o thá»‘ng kÃª

**CÃ¡c chá»©c nÄƒng Ä‘áº·c biá»‡t:**
- Truy cáº­p báº£ng Ä‘iá»u khiá»ƒn quáº£n lÃ½
- Táº¡o sá»± cá»‘ má»›i qua nÃºt "Táº¡o sá»± cá»‘ má»›i"
- GÃ¡n cÃ´ng viá»‡c cho cÃ¡c Coordinator hoáº·c Handler
- Xem lá»‹ch sá»­ cÃ¡c sá»± cá»‘ Ä‘Ã£ xÃ³a

---

### 2. Äiá»u phá»‘i (Coordinator) - Quáº£n lÃ½ Sá»± cá»‘ ğŸŸ¡

**MÃ´ táº£:** NgÆ°á»i phá»‘i há»£p/quáº£n lÃ½ sá»± cá»‘, gÃ¡n cÃ´ng viá»‡c cho ngÆ°á»i xá»­ lÃ½

**Quyá»n háº¡n:**
- âœ… Xem danh sÃ¡ch sá»± cá»‘
- âœ… Chá»‰nh sá»­a thÃ´ng tin sá»± cá»‘ (ngoÃ i tÃ¬nh tráº¡ng ká»¹ thuáº­t)
- âœ… Cáº­p nháº­t tráº¡ng thÃ¡i xá»­ lÃ½
- âœ… GÃ¡n/Há»§y gÃ¡n ngÆ°á»i xá»­ lÃ½
- âœ… ThÃªm ghi chÃº/nháº­n xÃ©t
- âœ… Xem bÃ¡o cÃ¡o thá»‘ng kÃª
- âŒ KhÃ´ng thá»ƒ táº¡o sá»± cá»‘ má»›i
- âŒ KhÃ´ng thá»ƒ xÃ³a sá»± cá»‘
- âŒ KhÃ´ng thá»ƒ xem bÃ¡o cÃ¡o toÃ n há»‡ thá»‘ng

**CÃ¡c chá»©c nÄƒng Ä‘áº·c biá»‡t:**
- CÃ³ nÃºt "Táº¡o sá»± cá»‘ má»›i" trong danh sÃ¡ch
- GÃ¡n cÃ´ng viá»‡c cho Handler
- Cáº­p nháº­t tráº¡ng thÃ¡i Ä‘á»ƒ theo dÃµi tiáº¿n Ä‘á»™

---

### 3. NgÆ°á»i Ä‘i xá»­ lÃ½ (Handler) - Xá»­ lÃ½ Sá»± cá»‘ ğŸ”µ

**MÃ´ táº£:** NgÆ°á»i thá»±c hiá»‡n cÃ´ng viá»‡c xá»­ lÃ½ sá»± cá»‘

**Quyá»n háº¡n:**
- âœ… Xem danh sÃ¡ch sá»± cá»‘
- âœ… Cáº­p nháº­t tráº¡ng thÃ¡i sá»± cá»‘ (chá»‰ khi Ä‘ang xá»­ lÃ½)
- âœ… ThÃªm ghi chÃº/nháº­n xÃ©t
- âŒ KhÃ´ng thá»ƒ táº¡o sá»± cá»‘
- âŒ KhÃ´ng thá»ƒ chá»‰nh sá»­a thÃ´ng tin sá»± cá»‘
- âŒ KhÃ´ng thá»ƒ xÃ³a sá»± cá»‘
- âŒ KhÃ´ng thá»ƒ gÃ¡n cÃ´ng viá»‡c

**CÃ¡c chá»©c nÄƒng Ä‘áº·c biá»‡t:**
- Chá»‰ cÃ³ thá»ƒ cáº­p nháº­t tráº¡ng thÃ¡i khi sá»± cá»‘ á»Ÿ tráº¡ng thÃ¡i "Äang xá»­ lÃ½"
- KhÃ´ng thá»ƒ Ä‘á»•i tráº¡ng thÃ¡i khi sá»± cá»‘ chÆ°a Ä‘Æ°á»£c gÃ¡n
- CÃ³ thá»ƒ thÃªm ghi chÃº Ä‘á»ƒ bÃ¡o cÃ¡o tiáº¿n Ä‘á»™

---

## Tráº¡ng thÃ¡i Sá»± cá»‘

Há»‡ thá»‘ng sá»­ dá»¥ng 3 tráº¡ng thÃ¡i sá»± cá»‘:

1. **Chá» xá»­ lÃ½** (Open) - ğŸ”´
   - Sá»± cá»‘ má»›i Ä‘Æ°á»£c táº¡o hoáº·c chÆ°a Ä‘Æ°á»£c gÃ¡n
   - Supervisor & Coordinator cÃ³ thá»ƒ gÃ¡n ngÆ°á»i xá»­ lÃ½

2. **Äang xá»­ lÃ½** (In Progress) - ğŸŸ¡
   - Sá»± cá»‘ Ä‘Ã£ Ä‘Æ°á»£c gÃ¡n cho Handler
   - Handler cÃ³ thá»ƒ cáº­p nháº­t tráº¡ng thÃ¡i
   - Supervisor & Coordinator cÃ³ thá»ƒ gÃ¡n láº¡i hoáº·c thay Ä‘á»•i tráº¡ng thÃ¡i

3. **ÄÃ£ giáº£i quyáº¿t** (Resolved) - ğŸŸ¢
   - Sá»± cá»‘ Ä‘Ã£ Ä‘Æ°á»£c xá»­ lÃ½ xong
   - Chá»‰ Supervisor & Coordinator má»›i cÃ³ thá»ƒ Ä‘á»•i tráº¡ng thÃ¡i nÃ y

---

## Quy trÃ¬nh Xá»­ lÃ½ Sá»± cá»‘

```
Supervisor/Coordinator
       â†“
  Táº¡o sá»± cá»‘
       â†“  
   GÃ¡n Handler
       â†“
   Status: Chá» xá»­ lÃ½ â†’ Äang xá»­ lÃ½
       â†“
     Handler
  Cáº­p nháº­t tiáº¿n Ä‘á»™
  ThÃªm ghi chÃº
       â†“
Supervisor/Coordinator
  Xem tiáº¿n Ä‘á»™
  Cáº­p nháº­t tráº¡ng thÃ¡i
       â†“
   Status: ÄÃ£ giáº£i quyáº¿t
```

---

## CÃ¡ch ÄÄƒng nháº­p vá»›i cÃ¡c Role khÃ¡c nhau

### ÄÄƒng nháº­p vá»›i role GiÃ¡m sÃ¡t
- TÃªn Ä‘Äƒng nháº­p: `admin`
- Máº­t kháº©u: `123456`
- Vai trÃ²: **GiÃ¡m sÃ¡t (Supervisor)**

### ÄÄƒng nháº­p vá»›i role Äiá»u phá»‘i
- TÃªn Ä‘Äƒng nháº­p: `coordinator`
- Máº­t kháº©u: `123456`
- Vai trÃ²: **Äiá»u phá»‘i (Coordinator)**

### ÄÄƒng nháº­p vá»›i role NgÆ°á»i Ä‘i xá»­ lÃ½
- TÃªn Ä‘Äƒng nháº­p: `technician`
- Máº­t kháº©u: `123456`
- Vai trÃ²: **NgÆ°á»i Ä‘i xá»­ lÃ½ (Handler)**

---

## Triá»ƒn khai Quyá»n háº¡n trong Code

### AuthContext
```typescript
// context/AuthContext.tsx
export type UserRole = 'supervisor' | 'coordinator' | 'handler'

interface AuthContextType {
  user: User | null
  hasPermission: (requiredRoles: UserRole[]) => boolean
}
```

### Sá»­ dá»¥ng trong Component
```typescript
const { hasPermission } = useAuth()

if (hasPermission(['supervisor', 'coordinator'])) {
  // Hiá»ƒn thá»‹ button táº¡o sá»± cá»‘
}
```

### PhÃ¢n quyá»n trong IncidentDetail
```typescript
{hasPermission(['supervisor', 'coordinator']) && (
  <button onClick={handleStatusUpdate}>
    Cáº­p nháº­t tráº¡ng thÃ¡i
  </button>
)}
```

---

## Má»Ÿ rá»™ng Quyá»n háº¡n

Äá»ƒ thÃªm vai trÃ² má»›i hoáº·c thay Ä‘á»•i quyá»n háº¡n:

1. Cáº­p nháº­t `UserRole` type trong `AuthContext.tsx`
2. ThÃªm role má»›i vÃ o `rolePermissions` trong `utils/permissions.ts`
3. Cáº­p nháº­t logic `hasPermission()` náº¿u cáº§n
4. ThÃªm Ä‘iá»u kiá»‡n phÃ¢n quyá»n vÃ o cÃ¡c component liÃªn quan

---

## Ghi chÃº Báº£o máº­t

- **Demo Mode**: Hiá»‡n táº¡i, máº­t kháº©u khÃ´ng Ä‘Æ°á»£c xÃ¡c minh thá»±c táº¿. Trong production, báº¡n cáº§n triá»ƒn khai xÃ¡c thá»±c thá»±c sá»±.
- **Authorization**: Quyá»n háº¡n Ä‘Æ°á»£c kiá»ƒm tra trÃªn client-side. Trong production, cáº§n kiá»ƒm tra trÃªn server-side.
- **Token**: Sá»­ dá»¥ng JWT hoáº·c session Ä‘á»ƒ lÆ°u trá»¯ thÃ´ng tin ngÆ°á»i dÃ¹ng an toÃ n.

---

## Há»i ÄÃ¡p

**Q: LÃ m cÃ¡ch nÃ o Ä‘á»ƒ thay Ä‘á»•i vai trÃ² cá»§a ngÆ°á»i dÃ¹ng?**  
A: Hiá»‡n táº¡i, vai trÃ² Ä‘Æ°á»£c chá»n khi Ä‘Äƒng nháº­p. Trong production, báº¡n cÃ³ thá»ƒ thÃªm trang "Quáº£n lÃ½ ngÆ°á»i dÃ¹ng" Ä‘á»ƒ Supervisor thay Ä‘á»•i vai trÃ².

**Q: CÃ³ thá»ƒ cÃ³ 4 vai trÃ² khÃ¡c ngoÃ i 3 cÃ¡i hiá»‡n táº¡i khÃ´ng?**  
A: CÃ³, báº¡n cÃ³ thá»ƒ dá»… dÃ ng thÃªm vai trÃ² má»›i báº±ng cÃ¡ch cáº­p nháº­t `UserRole` type vÃ  thÃªm quyá»n háº¡n trong `permissions.ts`.

**Q: NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ cÃ³ nhiá»u vai trÃ² cÃ¹ng lÃºc khÃ´ng?**  
A: Hiá»‡n táº¡i khÃ´ng, nhÆ°ng báº¡n cÃ³ thá»ƒ sá»­a Ä‘á»•i Ä‘á»ƒ há»— trá»£ Ä‘iá»u Ä‘Ã³ báº±ng cÃ¡ch thay Ä‘á»•i `user.role` thÃ nh `user.roles: UserRole[]`.
